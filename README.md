# 🎨 Pixiv タグ共起解析ツール

Pixivの作品データを分析して、特定のタグと一緒によく使われるタグを発見するStreamlitアプリケーションです。

![Pixiv Tag Analysis Tool](https://img.shields.io/badge/Pixiv-Tag%20Analysis-ff6b9d?style=for-the-badge&logo=python&logoColor=white)
![Python](https://img.shields.io/badge/Python-3.8+-3776ab?style=for-the-badge&logo=python&logoColor=white)
![Streamlit](https://img.shields.io/badge/Streamlit-FF4B4B?style=for-the-badge&logo=streamlit&logoColor=white)

## ✨ 特徴

### 🎯　バージョン
- **🎨 イラスト版** (`pixiv_illust_analyzer.py`): Pixivイラスト専用の分析ツール

### 🔍 多様な検索方式
- **タグ検索**: 作品に付けられたタグのみを検索（高精度）
- **キーワード検索**: タイトル・説明文も含めて検索（内容重視）
- **全文検索**: タグ・タイトル・説明文すべてを検索（最も幅広い）
- **タグ完全一致**: タグと完全に一致するもののみ（最も厳密）

### 🌐 高度なフィルタリング機能
- **英語タグ除外**: 日本語タグのみを表示
- **AI作品除外**: AI生成作品を自動判定・除外
- **R18コンテンツ対応**: 成人向けコンテンツの安全な検索

### 🔗 インタラクティブな結果表示
- **クリック可能な検索リンク**: 結果のタグをクリックして組み合わせ検索
- **データテーブル**: 使用頻度と組み合わせ情報を表形式で表示
- **円グラフ**: タグ使用頻度の視覚的な表示
- **詳細デバッグ情報**: 処理状況の透明な表示

### 🛡️ サーバー負荷軽減機能
- **動的間隔調整**: 取得件数に応じた最適なリクエスト間隔
- **ランダムジッター**: 負荷分散のためのランダムな時間調整
- **指数バックオフ**: エラー時の自動リトライ機能
- **Retry-After尊重**: サーバー指示の厳密な遵守

## 🚀 クイックスタート

### 1. 環境セットアップ

```bash
# リポジトリをクローン
git clone https://github.com/your-username/pixiv-tag-analyzer.git
cd pixiv-tag-analyzer

# 仮想環境の作成（推奨）
python -m venv venv
source venv/bin/activate  # Linux/Mac
# または
venv\Scripts\activate     # Windows

# 依存関係のインストール
pip install -r requirements.txt
```

### 2. Pixiv refresh_token の取得

1. **Pixivにログイン**: [pixiv.net](https://www.pixiv.net) にアクセス
2. **開発者ツールを開く**: F12キーまたは右クリック→「検証」
3. **Networkタブを選択**: 開発者ツールでNetworkタブをクリック
4. **ページを更新**: F5キーでページをリロード
5. **APIリクエストを探す**: `oauth/token` を含むリクエストを見つける
6. **refresh_tokenをコピー**: レスポンスから `refresh_token` の値をコピー

### 3. アプリケーションの起動

```bash

# または イラスト版を起動
streamlit run pixiv_illust_analyzer.py
```

### 4. 使用方法

1. **ログイン**: 取得したrefresh_tokenを入力してログイン
2. **検索方式選択**: 用途に応じて検索方式を選択
3. **フィルター設定**: 言語・AI作品除外などの設定
4. **タグ入力**: 分析したいタグやキーワードを入力
5. **分析開始**: ボタンをクリックして結果を待つ
6. **結果確認**: タグ一覧とグラフで結果を確認
7. **組み合わせ検索**: 気になるタグをクリックして追加検索

## 📋 必要なライブラリ

```txt
streamlit>=1.28.0
pixivpy3>=3.7.2
matplotlib>=3.7.0
pandas>=2.0.0
```

## 🔧 設定とカスタマイズ

### 検索方式の選び方

| 検索方式 | 検索対象 | 特徴 | おすすめ用途 |
|----------|----------|------|-------------|
| **タグ検索** | タグのみ | 従来の方式、精度高い | タグの共起関係を調べたい |
| **キーワード検索** | タイトル・説明文 | 作品の内容を反映 | 特定のテーマ・ジャンルを探す |
| **全文検索** | タグ・タイトル・説明文 | 最も幅広い検索 | できるだけ多くの作品を見つけたい |
| **タグ完全一致** | タグ（完全一致） | 最も厳密 | 正確なタグ名で絞り込みたい |

### フィルター機能

- **🌐 言語フィルター**（小説版）: 日本語以外の小説を自動除外
- **🔤 英語タグ除外**: 英語タグを結果から除外、日本語タグのみ表示
- **🤖 AI作品除外**: AI関連キーワードを持つ作品を検索対象から除外

### 取得件数の目安

| 件数 | 処理時間目安 | おすすめ用途 |
|------|-------------|-------------|
| 30-50件 | 1-2分 | お試し・R18系タグの初回検索 |
| 100-200件 | 3-7分 | 一般的な分析 |
| 300-500件 | 8-15分 | 詳細な分析 |
| 750-1000件 | 20-40分 | 網羅的な分析 |

## 💡 使用例

### 基本的な使用例

```
検索タグ: "初音ミク VOCALOID"
検索方式: タグ検索
取得件数: 200件
```

### 小説分析の例

```
検索キーワード: "異世界 ファンタジー"
検索方式: 全文検索
言語フィルター: 有効
取得件数: 300件
```

### R18コンテンツの分析

```
検索タグ: "R-18"
検索方式: タグ検索
取得件数: 50件（最初は少なめから）
```

## ⚠️ 注意事項とガイドライン

### 利用規約の遵守
- **Pixiv利用規約**: Pixivの利用規約を必ず遵守してください
- **API制限**: 過度なリクエストは避け、適切な間隔で使用してください
- **著作権**: データの取得・分析は個人利用の範囲内で行ってください

### 技術的な注意点
- **refresh_token**: 定期的に更新が必要です（通常1ヶ月程度）
- **サーバー負荷**: 大量取得時は時間がかかります（最大40分程度）
- **エラー処理**: ネットワークエラー時は自動でリトライします

### セキュリティ
- **トークン管理**: refresh_tokenは他人に見せないでください
- **共有注意**: スクリーンショット等でトークンが写らないよう注意

## 🐛 トラブルシューティング

### よくある問題と解決方法

**Q: ログインに失敗する**
- A: refresh_tokenが正しいか確認してください。期限切れの場合は再取得が必要です。

**Q: 検索結果が0件になる**
- A: タグ名のスペル確認、より一般的なタグでの検索、検索方式を「全文検索」に変更してみてください。

**Q: 処理が途中で止まる**
- A: デバッグ情報を確認してください。ネットワークエラーの場合は自動でリトライします。

**Q: AI作品除外が効かない**
- A: タグベースでの判定のため、完全ではありません。判定精度の向上は今後のアップデートで対応予定です。

### エラーコードと対処法

- **429 Too Many Requests**: リクエスト制限。しばらく待ってから再実行
- **401 Unauthorized**: 認証エラー。refresh_tokenを再取得
- **Network Error**: ネットワーク接続を確認


プロジェクトへの貢献を歓迎します！

1. **Fork** このリポジトリ
2. **Feature branch** を作成 (`git checkout -b feature/amazing-feature`)
3. **Commit** 変更内容 (`git commit -m 'Add amazing feature'`)
4. **Push** ブランチ (`git push origin feature/amazing-feature`)
5. **Pull Request** を作成

### 開発ガイドライン

- **コードスタイル**: PEP 8に準拠
- **コメント**: 日本語でのコメント推奨
- **テスト**: 新機能には適切なテストを追加
- **ドキュメント**: README.mdの更新

## 📄 ライセンス

このプロジェクトは MIT ライセンスの下で公開されています。詳細は [LICENSE](LICENSE) ファイルを参照してください。

## 🙏 謝辞

- **Pixiv**: 素晴らしいプラットフォームとAPIの提供
- **pixivpy3**: Pixiv API の優秀なPythonラッパー
- **Streamlit**: 美しいWebアプリケーションフレームワーク


---


**免責事項**: このツールは教育・研究目的で作成されています。Pixivの利用規約を遵守し、適切な用途でご利用ください。
